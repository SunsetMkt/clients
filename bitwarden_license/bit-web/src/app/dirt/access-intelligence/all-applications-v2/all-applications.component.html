<!-- Loading -->
<div *ngIf="store.loading()">
  <tools-risk-insights-loading></tools-risk-insights-loading>
</div>

<!-- Header -->
<div class="tw-mt-4" *ngIf="!store.loading() && !store.applicationsWithCriticalFlag().length">
  <bit-no-items [icon]="noItemsIcon" class="tw-text-main">
    <!-- Title -->
    <ng-container slot="title">
      <h2 class="tw-font-semibold tw-mt-4">
        {{ "noAppsInOrgTitle" | i18n: store.currentOrganization()?.name }}
      </h2>
    </ng-container>
    <!-- Description -->
    <ng-container slot="description">
      <div class="tw-flex tw-flex-col tw-mb-2">
        <span class="tw-text-muted">
          {{ "noAppsInOrgDescription" | i18n }}
        </span>
        <a class="tw-text-primary-600" routerLink="/login">{{ "learnMore" | i18n }}</a>
      </div>
    </ng-container>
  </bit-no-items>
</div>

<!-- Cards for stats -->
<div
  class="tw-mt-4 tw-flex tw-flex-col"
  *ngIf="!store.loading() && store.applicationsWithCriticalFlag().length"
>
  <h2 class="tw-mb-6" bitTypography="h2">{{ "allApplications" | i18n }}</h2>
  <div class="tw-flex tw-gap-6">
    <dirt-card
      #allAppsOrgAtRiskMembers
      class="tw-flex-1 tw-cursor-pointer"
      [ngClass]="{ 'tw-bg-primary-100': store.drawerInvokerId() === 'allAppsOrgAtRiskMembers' }"
      [title]="'atRiskMembers' | i18n"
      [value]="store.summary().totalAtRiskMemberCount"
      [maxValue]="store.summary().totalMemberCount"
      (click)="store.showAllAtRiskMembers()"
    >
    </dirt-card>
    <dirt-card
      #allAppsOrgAtRiskApplications
      class="tw-flex-1 tw-cursor-pointer"
      [ngClass]="{
        'tw-bg-primary-100': store.drawerInvokerId() === 'allAppsOrgAtRiskApplications',
      }"
      [title]="'atRiskApplications' | i18n"
      [value]="store.summary().totalAtRiskApplicationCount"
      [maxValue]="store.summary().totalApplicationCount"
      (click)="store.showAtRiskApplications()"
    >
    </dirt-card>
  </div>

  <!-- Search -->
  <div class="tw-flex tw-mt-8 tw-mb-4 tw-gap-4">
    <bit-search
      [placeholder]="'searchApps' | i18n"
      class="tw-grow"
      [formControl]="searchControl"
    ></bit-search>
    <button
      type="button"
      [buttonType]="'primary'"
      bitButton
      [disabled]="!store.selectedEntityIds().size"
      [loading]="store.isMarkingAppsAsCritical()"
      (click)="store.markAppsAsCritical()"
    >
      <i
        class="bwi tw-mr-2"
        [ngClass]="store.selectedEntityIds().size ? 'bwi-star-f' : 'bwi-star'"
      ></i>
      {{ "markAppAsCritical" | i18n }}
    </button>
  </div>

  <!-- Table with all the application data -->
  <app-table-row-scrollable
    [dataSource]="dataSource"
    [showRowCheckBox]="true"
    [showRowMenuForCriticalApps]="false"
    [selectedUrls]="store.selectedApplicationsIds()"
    [selectedApplication]="store.drawerInvokerId()"
    [checkboxChange]="onCheckboxChange"
    [showAppAtRiskMembers]="store.showAtRiskApplicationMembers"
  ></app-table-row-scrollable>
</div>
